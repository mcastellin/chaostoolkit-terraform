title: Example of chaostoolkit-terraform control
description: Use chaosterraform to deploy terraform code

configuration:
  tf__restart: "always"

controls:
  - name: chaosterraform
    provider:
      type: python
      module: chaosterraform.control
      arguments:
        retain: true

steady-state-hypothesis:
  title: "check-service-online"
  probes:
    - name: "service-should-respond"
      type: probe
      tolerance: 200
      provider:
        type: http
        url: "http://localhost:${tf_out__container_port}/"
        method: GET
        timeout: 3

method:
  - name: "terminate-nginx-service"
    type: action
    provider:
      type: process
      path: "docker"
      arguments: "exec ${tf_out__container_name} nginx -s quit"
    pauses:
      after: 5

